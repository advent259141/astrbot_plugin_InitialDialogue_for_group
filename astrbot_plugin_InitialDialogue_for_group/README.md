# 群聊主动对话插件 (Initiative Dialogue for Group)

这是一个基于原版私聊主动对话插件改造的群聊版本，专门为群聊场景设计，当群聊长时间无人说话时会主动发送消息来活跃群聊气氛。

## 功能特性

### 🎯 核心功能
- **智能群聊监控**: 实时监控群聊活跃度，检测不活跃状态
- **自动主动发言**: 当群聊超过设定时间无人说话时，自动发送主动消息
- **渐进式交互**: 支持连续多次主动发言，每次使用不同的策略和语调
- **时间段适配**: 根据不同时间段（早上、下午、晚上等）调整消息内容

### 📊 群聊特定优化
- **群聊白名单**: 支持设置特定群聊白名单，只在指定群聊中启用
- **活跃度检测**: 避免在群聊正在热烈讨论时发送主动消息
- **群聊上下文**: 针对群聊场景优化的提示词和交互方式
- **消息计数管理**: 每个群聊独立管理连续主动消息次数

### ⚙️ 可配置参数
- **时间设置**: 不活跃时间阈值、发送延迟、活动时间段等
- **消息限制**: 最大连续主动消息数量，避免过度打扰
- **白名单管理**: 灵活的群聊白名单配置
- **节日检测**: 支持节日相关的特殊问候和提示

## 配置说明

### 基础配置
```json
{
  "time_settings": {
    "inactive_time_seconds": 10800,      // 3小时无人说话后触发
    "max_response_delay_seconds": 1800,  // 30分钟内随机发送
    "activity_start_hour": 9,            // 每天9点开始活动
    "activity_end_hour": 22,             // 每天22点停止活动
    "max_consecutive_messages": 2        // 最多连续发送2条消息
  }
}
```

### 群聊白名单
```json
{
  "whitelist": {
    "enabled": true,                     // 启用白名单
    "group_ids": ["12345", "67890"]      // 允许的群聊ID列表
  }
}
```

### 群聊特定设置
```json
{
  "group_specific_settings": {
    "avoid_disturbing_active_chat": true,    // 避免打扰活跃群聊
    "active_threshold_messages": 5,         // 30分钟内超过5条消息认为活跃
    "active_check_minutes": 30,             // 活跃度检测时间窗口
    "mention_bot_probability": 0.3          // 30%概率@机器人自己
  }
}
```

## 安装使用

1. **下载插件**: 将整个 `astrbot_plugin_InitialDialogue_for_group` 文件夹放入 AstrBot 的插件目录

2. **配置插件**: 在 AstrBot 管理界面中配置插件参数，至少需要设置：
   - `self_id`: 机器人的QQ号
   - `whitelist`: 设置允许的群聊ID（如果启用白名单）

3. **启用插件**: 在 AstrBot 插件管理中启用该插件

4. **测试功能**: 在配置的群聊中等待指定时间，观察机器人是否会主动发言

## 工作原理

### 1. 消息监听
- 监听所有群聊消息事件
- 更新群聊最后活跃时间
- 重置连续主动消息计数

### 2. 不活跃检测
- 每30秒检查一次所有群聊状态
- 计算每个群聊的不活跃时间
- 触发条件：超过设定的不活跃时间阈值

### 3. 智能发送
- 根据连续发送次数选择不同的提示词策略
- 考虑当前时间段调整消息内容
- 避免在群聊活跃期间发送

### 4. 状态管理
- 持久化存储群聊状态数据
- 管理每个群聊的连续消息计数
- 记录主动消息发送历史

## 提示词策略

插件采用渐进式提示词策略：

- **首次发送** (1次): 友好地表达注意到群聊冷清，想要活跃气氛
- **继续发送** (2次): 理解大家可能在忙，但仍然关心群友
- **最后发送** (达到上限): 温和地表达会减少主动发言频率

## 注意事项

### 使用建议
1. **合理设置时间**: 建议不活跃时间设置为2-4小时，避免过于频繁
2. **限制群聊数量**: 不要在过多群聊中同时启用，可能造成消息轰炸
3. **观察反馈**: 根据群友反馈调整配置参数
4. **测试功能**: 在小群或测试群中先测试功能

### 技术限制
1. **依赖AstrBot**: 需要AstrBot框架支持
2. **需要LLM**: 需要配置可用的大语言模型
3. **权限要求**: 机器人需要在目标群聊中有发言权限

## 版本信息

- **版本**: 1.0.0
- **作者**: Jason
- **基于**: InitiativeDialogue 私聊版本
- **适用**: AstrBot 框架

## 更新日志

### v1.0.0 (2024)
- 首个群聊版本发布
- 基于私聊版本完全重构
- 新增群聊特定功能和优化
- 支持群聊白名单和活跃度检测

## 技术支持

如有问题或建议，请参考原版插件文档或联系开发者。

---

**注意**: 这是一个AI主动对话插件，请确保在使用前获得群成员的理解和同意，避免对群聊造成不必要的打扰。
